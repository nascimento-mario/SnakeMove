<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finger-Controlled Snake Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }
        
        .status {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .status.loading {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }
        
        .status.success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .panel {
            background: #0f172a;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .panel-title {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .score {
            font-size: 1.8em;
            font-weight: bold;
            color: #4ecca3;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-green {
            background: #22c55e;
            color: white;
        }
        
        .btn-green:hover:not(:disabled) {
            background: #16a34a;
        }
        
        .btn-red {
            background: #ef4444;
            color: white;
        }
        
        .btn-red:hover:not(:disabled) {
            background: #dc2626;
        }
        
        .btn-blue {
            background: #3b82f6;
            color: white;
        }
        
        .btn-blue:hover:not(:disabled) {
            background: #2563eb;
        }
        
        #gameCanvas {
            display: block;
            border: 4px solid #1e293b;
            border-radius: 8px;
            background: #1a1a2e;
        }
        
        #webcam {
            width: 100%;
            border-radius: 8px;
            transform: scaleX(-1);
            background: #000;
        }
        
        .info-box {
            background: #1e293b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            color: #4ecca3;
        }
        
        .info-box ul {
            list-style: none;
            line-height: 1.8;
        }
        
        .info-box li {
            color: #cbd5e1;
        }
        
        .stat-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #1e293b;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .stat-label {
            color: #94a3b8;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .stat-value.active {
            color: #22c55e;
        }
        
        .stat-value.inactive {
            color: #ef4444;
        }
        
        .stat-value.stopped {
            color: #f59e0b;
        }
        
        .gesture-display {
            text-align: center;
            font-size: 3em;
            padding: 20px;
            background: #1e293b;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .direction-display {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            padding: 20px;
            background: #1e293b;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .tip-box {
            background: rgba(234, 179, 8, 0.2);
            border: 1px solid #eab308;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .tip-box p {
            color: #fef08a;
            line-height: 1.6;
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border-radius: 8px;
        }
        
        .game-over h2 {
            font-size: 3em;
            color: #ef4444;
            margin-bottom: 20px;
        }
        
        .game-over p {
            font-size: 1.5em;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üëÜ Finger-Controlled Snake Game</h1>
        <p class="subtitle">Point your finger to move, close your hand to stop!</p>
        
        <div id="statusMessage"></div>
        
        <div class="grid">
            <!-- Game Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="score">Score: <span id="score">0</span></div>
                    <div class="controls">
                        <button id="startBtn" class="btn-green" onclick="startGame()">
                            ‚ñ∂ Start Game
                        </button>
                        <button class="btn-blue" onclick="resetGame()">
                            ‚Üª Reset
                        </button>
                    </div>
                </div>
                
                <div style="position: relative;">
                    <canvas id="gameCanvas" width="400" height="400"></canvas>
                    <div id="gameOverScreen" class="game-over" style="display: none;">
                        <h2>Game Over!</h2>
                        <p>Final Score: <span id="finalScore">0</span></p>
                        <button class="btn-blue" onclick="resetGame()">Play Again</button>
                    </div>
                </div>
                
                <div class="info-box">
                    <h3>How to Play:</h3>
                    <ul>
                        <li>‚Ä¢ Start the camera and the game</li>
                        <li>‚Ä¢ Point your index finger in any direction to move</li>
                        <li>‚Ä¢ Point UP ‚òùÔ∏è to move up</li>
                        <li>‚Ä¢ Point DOWN üëá to move down</li>
                        <li>‚Ä¢ Point LEFT üëà to move left</li>
                        <li>‚Ä¢ Point RIGHT üëâ to move right</li>
                        <li>‚Ä¢ Close your hand ‚úä to STOP</li>
                        <li>‚Ä¢ Eat red food to grow and score!</li>
                    </ul>
                </div>
            </div>
            
            <!-- Camera Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Camera Feed</div>
                    <button id="cameraBtn" class="btn-green" onclick="toggleCamera()">
                        üìπ Start Camera
                    </button>
                </div>
                
                <video id="webcam" autoplay playsinline></video>
                
                <div class="gesture-display" id="gestureDisplay">
                    ‚úã Show your hand
                </div>
                
                <div class="stat-box">
                    <span class="stat-label">Gesture Status:</span>
                    <span class="stat-value inactive" id="gestureStatus">No hand detected</span>
                </div>
                
                <div class="direction-display" id="directionDisplay">
                    Waiting...
                </div>
                
                <div class="tip-box">
                    <p><strong>üí° Tips:</strong></p>
                    <p>‚Ä¢ Hold your hand clearly visible to the camera</p>
                    <p>‚Ä¢ Point with your index finger only</p>
                    <p>‚Ä¢ Close all fingers to stop the snake</p>
                    <p>‚Ä¢ The snake only moves when you're pointing!</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    
    <script>
        // Game variables
        const GRID_SIZE = 20;
        const CELL_SIZE = 20;
        let snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
        let direction = null; // null means stopped
        let food = {x: 15, y: 15};
        let score = 0;
        let gameOver = false;
        let gameActive = false;
        let gameLoop = null;
        
        // Camera variables
        let hands = null;
        let camera = null;
        let cameraActive = false;
        let currentGesture = 'none';
        let currentDirection = null;
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const videoElement = document.getElementById('webcam');
        
        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('statusMessage').style.display = 'none';
        }
        
        // Calculate distance between two points
        function distance(point1, point2) {
            return Math.sqrt(
                Math.pow(point1.x - point2.x, 2) + 
                Math.pow(point1.y - point2.y, 2)
            );
        }
        
        // Detect if finger is extended
        function isFingerExtended(landmarks, fingerTip, fingerPip) {
            const tip = landmarks[fingerTip];
            const pip = landmarks[fingerPip];
            const wrist = landmarks[0];
            
            // Finger is extended if tip is farther from wrist than pip
            return distance(tip, wrist) > distance(pip, wrist);
        }
        
        // Detect pointing gesture and direction
        function detectPointingGesture(landmarks) {
            // Index finger landmarks: tip=8, pip=6, dip=7
            // Thumb: tip=4
            // Middle finger: tip=12, pip=10
            // Ring finger: tip=16, pip=14
            // Pinky: tip=20, pip=18
            
            const indexExtended = isFingerExtended(landmarks, 8, 6);
            const middleExtended = isFingerExtended(landmarks, 12, 10);
            const ringExtended = isFingerExtended(landmarks, 16, 14);
            const pinkyExtended = isFingerExtended(landmarks, 20, 18);
            
            // Pointing: only index finger extended
            const isPointing = indexExtended && !middleExtended && !ringExtended && !pinkyExtended;
            
            // Closed fist: no fingers extended
            const isClosed = !indexExtended && !middleExtended && !ringExtended && !pinkyExtended;
            
            if (isClosed) {
                return { gesture: 'closed', direction: null };
            }
            
            if (!isPointing) {
                return { gesture: 'none', direction: null };
            }
            
            // Get index finger tip and base
            const fingerTip = landmarks[8];
            const fingerBase = landmarks[5];
            
            // Calculate direction vector (flip for intuitive controls)
            const dx = -(fingerTip.x - fingerBase.x);
            const dy = -(fingerTip.y - fingerBase.y);
            
            const threshold = 0.05;
            
            // Determine dominant direction
            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > threshold) {
                    return { gesture: 'pointing', direction: 'right' };
                } else if (dx < -threshold) {
                    return { gesture: 'pointing', direction: 'left' };
                }
            } else {
                if (dy > threshold) {
                    return { gesture: 'pointing', direction: 'up' };
                } else if (dy < -threshold) {
                    return { gesture: 'pointing', direction: 'down' };
                }
            }
            
            return { gesture: 'pointing', direction: 'none' };
        }
        
        // Initialize MediaPipe Hands
        function initHands() {
            hands = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });
            
            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.7,
                minTrackingConfidence: 0.7
            });
            
            hands.onResults(onResults);
        }
        
        // Process hand tracking results
        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                const detection = detectPointingGesture(landmarks);
                
                currentGesture = detection.gesture;
                currentDirection = detection.direction;
                
                // Update UI
                if (detection.gesture === 'closed') {
                    document.getElementById('gestureDisplay').textContent = '‚úä Closed (STOPPED)';
                    document.getElementById('gestureStatus').textContent = 'Hand closed - Snake stopped';
                    document.getElementById('gestureStatus').className = 'stat-value stopped';
                    document.getElementById('directionDisplay').textContent = '‚è∏ STOPPED';
                    direction = null;
                } else if (detection.gesture === 'pointing' && detection.direction) {
                    const arrows = { up: '‚òùÔ∏è UP', down: 'üëá DOWN', left: 'üëà LEFT', right: 'üëâ RIGHT' };
                    const dirSymbols = { up: '‚Üë', down: '‚Üì', left: '‚Üê', right: '‚Üí' };
                    
                    document.getElementById('gestureDisplay').textContent = arrows[detection.direction] || 'üëÜ Pointing';
                    document.getElementById('gestureStatus').textContent = 'Pointing detected - Snake moving';
                    document.getElementById('gestureStatus').className = 'stat-value active';
                    document.getElementById('directionDisplay').textContent = `Moving ${dirSymbols[detection.direction]} ${detection.direction.toUpperCase()}`;
                    
                    // Update snake direction based on pointing
                    if (detection.direction === 'up') direction = {x: 0, y: -1};
                    else if (detection.direction === 'down') direction = {x: 0, y: 1};
                    else if (detection.direction === 'left') direction = {x: -1, y: 0};
                    else if (detection.direction === 'right') direction = {x: 1, y: 0};
                } else {
                    document.getElementById('gestureDisplay').textContent = '‚úã Hand detected';
                    document.getElementById('gestureStatus').textContent = 'Point index finger to move';
                    document.getElementById('gestureStatus').className = 'stat-value inactive';
                    document.getElementById('directionDisplay').textContent = 'Point to move';
                    direction = null;
                }
            } else {
                currentGesture = 'none';
                currentDirection = null;
                direction = null;
                document.getElementById('gestureDisplay').textContent = '‚úã Show your hand';
                document.getElementById('gestureStatus').textContent = 'No hand detected';
                document.getElementById('gestureStatus').className = 'stat-value inactive';
                document.getElementById('directionDisplay').textContent = 'Waiting...';
            }
        }
        
        // Toggle camera
        async function toggleCamera() {
            if (cameraActive) {
                stopCamera();
            } else {
                await startCamera();
            }
        }
        
        async function startCamera() {
            try {
                showStatus('Starting camera...', 'loading');
                
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {width: 640, height: 480}
                });
                
                videoElement.srcObject = stream;
                
                await new Promise((resolve) => {
                    videoElement.onloadedmetadata = () => {
                        videoElement.play();
                        resolve();
                    };
                });
                
                if (!hands) {
                    initHands();
                }
                
                camera = new Camera(videoElement, {
                    onFrame: async () => {
                        await hands.send({image: videoElement});
                    },
                    width: 640,
                    height: 480
                });
                
                await camera.start();
                
                cameraActive = true;
                document.getElementById('cameraBtn').textContent = 'üõë Stop Camera';
                document.getElementById('cameraBtn').className = 'btn-red';
                showStatus('Camera ready! Now start the game and point your finger!', 'success');
                setTimeout(hideStatus, 3000);
                
            } catch (error) {
                console.error('Camera error:', error);
                showStatus('Failed to start camera. Please allow camera access.', 'error');
            }
        }
        
        function stopCamera() {
            if (videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            
            if (camera) {
                camera.stop();
                camera = null;
            }
            
            cameraActive = false;
            document.getElementById('cameraBtn').textContent = 'üìπ Start Camera';
            document.getElementById('cameraBtn').className = 'btn-green';
            hideStatus();
        }
        
        // Game functions
        function generateFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
            } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
            return newFood;
        }
        
        function moveSnake() {
            if (gameOver || !gameActive) return;
            
            // Only move if direction is set (finger is pointing)
            if (!direction) return;
            
            const head = snake[0];
            const newHead = {
                x: head.x + direction.x,
                y: head.y + direction.y
            };
            
            // Check wall collision
            if (newHead.x < 0 || newHead.x >= GRID_SIZE || 
                newHead.y < 0 || newHead.y >= GRID_SIZE) {
                endGame();
                return;
            }
            
            // Check self collision
            if (snake.some(segment => segment.x === newHead.x && segment.y === newHead.y)) {
                endGame();
                return;
            }
            
            snake.unshift(newHead);
            
            // Check food collision
            if (newHead.x === food.x && newHead.y === food.y) {
                score += 10;
                document.getElementById('score').textContent = score;
                food = generateFood();
            } else {
                snake.pop();
            }
            
            drawGame();
        }
        
        function drawGame() {
            // Clear canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#16213e';
            ctx.lineWidth = 1;
            for (let i = 0; i <= GRID_SIZE; i++) {
                ctx.beginPath();
                ctx.moveTo(i * CELL_SIZE, 0);
                ctx.lineTo(i * CELL_SIZE, GRID_SIZE * CELL_SIZE);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * CELL_SIZE);
                ctx.lineTo(GRID_SIZE * CELL_SIZE, i * CELL_SIZE);
                ctx.stroke();
            }
            
            // Draw snake
            snake.forEach((segment, index) => {
                ctx.fillStyle = index === 0 ? '#4ecca3' : '#45b393';
                ctx.fillRect(
                    segment.x * CELL_SIZE + 1,
                    segment.y * CELL_SIZE + 1,
                    CELL_SIZE - 2,
                    CELL_SIZE - 2
                );
            });
            
            // Draw food
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.arc(
                food.x * CELL_SIZE + CELL_SIZE / 2,
                food.y * CELL_SIZE + CELL_SIZE / 2,
                CELL_SIZE / 2 - 2,
                0,
                Math.PI * 2
            );
            ctx.fill();
        }
        
        function startGame() {
            if (!cameraActive) {
                showStatus('Please start the camera first!', 'error');
                setTimeout(hideStatus, 3000);
                return;
            }
            
            if (gameOver) {
                resetGame();
            }
            
            gameActive = true;
            document.getElementById('startBtn').textContent = '‚è∏ Pause';
            document.getElementById('startBtn').onclick = pauseGame;
            document.getElementById('startBtn').className = 'btn-red';
            
            // Slower game loop for elderly users - 300ms instead of 150ms
            gameLoop = setInterval(moveSnake, 150);
        }
        
        function pauseGame() {
            gameActive = false;
            document.getElementById('startBtn').textContent = '‚ñ∂ Resume';
            document.getElementById('startBtn').onclick = startGame;
            document.getElementById('startBtn').className = 'btn-green';
            if (gameLoop) {
                clearInterval(gameLoop);
                gameLoop = null;
            }
        }
        
        function endGame() {
            gameOver = true;
            gameActive = false;
            document.getElementById('startBtn').textContent = '‚ñ∂ Start Game';
            document.getElementById('startBtn').onclick = startGame;
            document.getElementById('startBtn').className = 'btn-green';
            if (gameLoop) {
                clearInterval(gameLoop);
                gameLoop = null;
            }
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        function resetGame() {
            snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
            direction = null;
            food = generateFood();
            score = 0;
            gameOver = false;
            gameActive = false;
            
            document.getElementById('score').textContent = '0';
            document.getElementById('startBtn').textContent = '‚ñ∂ Start Game';
            document.getElementById('startBtn').onclick = startGame;
            document.getElementById('startBtn').className = 'btn-green';
            document.getElementById('gameOverScreen').style.display = 'none';
            
            if (gameLoop) {
                clearInterval(gameLoop);
                gameLoop = null;
            }
            
            drawGame();
        }
        
        // Initialize
        drawGame();
        showStatus('Ready! Click "Start Camera" to begin.', 'success');
    </script>
</body>
</html>